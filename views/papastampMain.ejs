<!DOCTYPE html>
<html lang="en">
<head>
    <title>Best Food</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Staple Food Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
	SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola web design" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <!-- Custom Theme files -->
    <link href="css/bootstrap.css" type="text/css" rel="stylesheet" media="all">
    <link href="css/style.css" type="text/css" rel="stylesheet" media="all">
    <link href="css/font-awesome.css" rel="stylesheet"> <!-- font-awesome icons -->
    <!-- //Custom Theme files -->
    <!-- js -->
    <script src="js/jquery-2.2.3.min.js"></script>
    <!-- //js -->
    <!-- web-fonts -->
    <link href="//fonts.googleapis.com/css?family=Berkshire+Swash" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Yantramanav:100,300,400,500,700,900" rel="stylesheet">
    <!-- //web-fonts -->
</head>

<form style="display:none" name="current_data" id="current_data">
    <input type="hidden" name="url" id="url" value="<%= url %>"/>
    <input type="hidden" name="shop_length" id="shop_length" value=""/>
    <input type="hidden" name="current_lat" id="current_lat" value=""/>
    <input type="hidden" name="current_lon" id="current_lon" value=""/>
    <input type="hidden" name="current_addr" id="current_addr" value=""/>
</form>

<form style="display:none" name="shop_addr_list" id="shop_addr_list">
</form>

<body>
<!-- banner -->
<div class="banner about-w3bnr">
    <!-- header -->
    <div class="header">
        <div class="w3ls-header"><!-- header-one -->
            <div class="container">
                <div class="w3ls-header-left">
                    <p>나의 스탬프 관리</p>
                </div>
                <div class="clearfix"> </div>
            </div>
        </div>
        <!-- //header-one -->
        <!-- navigation -->
        <div class="navigation agiletop-nav">
            <div class="container">
                <nav class="navbar navbar-default">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header w3l_logo">
                        <button id="papa-menu" type="button" class="navbar-toggle collapsed navbar-toggle1" data-toggle="collapse" data-target="#bs-megadropdown-tabs">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <h1 style="float:left;"><a href="/main" style="color:#CD853F">PaPa<p style="float:right;font-size:0.6em;margin-left:10px;color:#EE82EE">Stamp</p></a>
                            <a><span>Stamp Management System</span></a></h1>
                    </div>
                    <div class="collapse navbar-collapse" id="bs-megadropdown-tabs">
                        <ul class="nav navbar-nav navbar-right">
                            <li><a style="color:#CD853F;" href="/main">Home</a></li>
                            <li><a href="/contact" class="active">Contact Us</a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <!-- //navigation -->
    </div>
    <!-- //header-end -->
    <!-- banner-text -->
    <div class="banner-text">
    </div>
</div>
<!-- //banner -->
<!-- breadcrumb -->
<div class="container">
    <ol class="breadcrumb w3l-crumbs">
        <li><a href="javascript:"><i class="fa fa-home"></i> Home</a></li>
        <li class="active">
            <select id="cooperatorList" name="agileinfo_search" required="" onchange="current()">
                <option value="myShop">나의 스탬프 등록 지점</option>
                <option value="papaShop" >파파 스탬프 등록 지점</option>
            </select>
        </li>

    </ol>
</div>
<!-- //breadcrumb -->
<!-- contact -->
<div id="contact" class="contact cd-section">
    <h3 class="w3ls-title">Papa Stamp Map</h3>
    <p class="w3lsorder-text">온라인으로 스탬프를 편리하게 관리하세요!!!</p>

    <!-- 지도 확대, 축소 컨트롤 div 입니다 -->
    <div class="custom_zoomcontrol radius_border">
        <span onclick="zoomIn()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png" alt="확대"></span>
        <span onclick="zoomOut()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png" alt="축소"></span>
    </div>

    <!-- map -->
    <div id="map" class="map_wrap"></div>
    <!-- //map -->

    <div class="container">
        <div class="contact-row agileits-w3layouts">
            <div class="col-xs-6 col-sm-6 contact-w3lsright" id="map_list_wrap">
            </div>
            <div class="clearfix"> </div>
        </div>
    </div>

</div>
<!-- //contact -->
<div class="copyw3-agile">
    <div class="container">
        <p>&copy; 2017 Staple Food. All rights reserved | Design by <a href="https://w3layouts.com/">W3layouts</a></p>
    </div>
</div>
<!-- //footer -->
<!-- cart-js -->
<script src="js/minicart.js"></script>
<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=076df8cf69c376d5065c3bc99891a438&libraries=clusterer,services"></script>
<script>
    current();
    w3ls.render();

    w3ls.cart.on('w3sb_checkout', function (evt) {
        var items, len, i;

        if (this.subtotal() > 0) {
            items = this.items();

            for (i = 0, len = items.length; i < len; i++) {
            }
        }
    });

    var currentLat = '';
    var currentLon = '';
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new daum.maps.LatLng(37.650804099999995, 126.88645269999999), // 지도의 중심좌표
            level: 10 // 지도의 확대 레벨
        };

    var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    // 현재 위치 표시
    function current() {
        if (navigator.geolocation) {

            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
            navigator.geolocation.getCurrentPosition(function(position) {
                currentLat = position.coords.latitude; // 위도
                currentLon = position.coords.longitude; // 경도

                var currentMarkerSrc = '/images/current_point.png', // 메인 마커이미지의 주소입니다
                    currentMarkerSize = new daum.maps.Size(35, 49), // 메인  마커이미지의 크기입니다
                    currentMarkerOption = {offset: new daum.maps.Point(19, 58)}; // 메인 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

                // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
                var currentMarkerImage = new daum.maps.MarkerImage(currentMarkerSrc, currentMarkerSize, currentMarkerOption);
                var currentMarkerPosition = new daum.maps.LatLng(currentLat, currentLon); // 마커가 표시될 위치입니다

                shopList(currentLat, currentLon);
                // 마커와 인포윈도우를 표시합니다
                displayMarker(currentMarkerPosition, currentMarkerImage);
            });

        } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
            // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
            console.log("fail the geolocation")
            var locPosition = new daum.maps.LatLng(37.650804099999995, 126.88645269999999); // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
            markerContentN = 'GPS 연결을 확인하여 주십시오';

            // 마커를 생성합니다
            var marker = new daum.maps.Marker({
                map: map,
                position: locPosition,
                image: markerContentN // 마커이미지 설정
            });

            displayMarker(currentMarkerPosition, currentMarkerImage);
        }
    }

    // 지도에 마커와 인포윈도우를 표시하는 함수입니다
    function displayMarker(currentMarkerPosition, currentMarkerImage) {
        map = new daum.maps.Map(document.getElementById('map'), { // 지도를 표시할 div
            center : currentMarkerPosition, // 지도의 중심좌표
            level : 10 // 지도의 확대 레벨
        });

        // 현재 위치 마커를 생성합니다
        var marker = new daum.maps.Marker({
            map: map,
            position: currentMarkerPosition,
            image: currentMarkerImage // 마커이미지 설정
        });
        marker.setMap(map);

        showClusterer();
    };

    function showClusterer() {
        var cooperatorName = document.getElementById("cooperatorList").value;
        var cooperatorShopUrl ='/mapData/cooperator/'+cooperatorName+'.json';

        // 마커 클러스터러를 생성합니다
        var clusterer = new daum.maps.MarkerClusterer({
            map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체
            averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정
            minLevel: 10 // 클러스터 할 최소 지도 레벨
        });

        var selectedMarker = null;

        // 데이터를 가져오기 위해 jQuery를 사용합니다
        // 데이터를 가져와 마커를 생성하고 클러스터러 객체에 넘겨줍니다
        $.get(cooperatorShopUrl, function(data) {
            // 데이터에서 좌표 값을 가지고 마커를 표시합니다
            // 마커 클러스터러로 관리할 마커 객체는 생성할 때 지도 객체를 설정하지 않습니다



            if(cooperatorName == "myShop") {
                var imageSrc = '/images/my_point1.png';
                var clickImageSrc = '/images/select_point1.png';
            }else {
                var imageSrc = '/images/shop_point.png';
                var clickImageSrc = '/images/select_point.png';
            }
            var imageSize = new daum.maps.Size(35, 49), // 마커이미지의 크기입니다
                imageOprion = {offset: new daum.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
            var normalImage = new daum.maps.MarkerImage(imageSrc, imageSize, imageOprion);

            var clickImageSize = new daum.maps.Size(35, 49), // 마커이미지의 크기입니다
                clickImageOprion = {offset: new daum.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
            var clickImage = new daum.maps.MarkerImage(clickImageSrc, clickImageSize, clickImageOprion);


            var markers = $(data.positions).map(function(i, position) {
                var marker = new daum.maps.Marker({
                    position : new daum.maps.LatLng(position.lat, position.lng),
                    image:normalImage
                });

                daum.maps.event.addListener(marker, 'click', function() {
                    // 클릭된 마커가 없고, click 마커가 클릭된 마커가 아니면
                    // 마커의 이미지를 클릭 이미지로 변경합니다
                    if (!selectedMarker || selectedMarker !== marker) {
                        // 클릭된 마커 객체가 null이 아니면
                        // 클릭된 마커의 이미지를 기본 이미지로 변경하고
                        !!selectedMarker && selectedMarker.setImage(normalImage);

                        // 현재 클릭된 마커의 이미지는 클릭 이미지로 변경합니다
                        marker.setImage(clickImage);
                    }

                    // 클릭된 마커를 현재 클릭된 마커 객체로 설정합니다
                    selectedMarker = marker;
                });

                return marker;
            });

            // 클러스터러에 마커들을 추가합니다
            clusterer.addMarkers(markers);
        });

        /* $.get("/mapData/tv/wednesShop.json", function(data) {
         // 데이터에서 좌표 값을 가지고 마커를 표시합니다
         // 마커 클러스터러로 관리할 마커 객체는 생성할 때 지도 객체를 설정하지 않습니다

         var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png', // 마커이미지의 주소입니다
         imageSize = new daum.maps.Size(44, 49), // 마커이미지의 크기입니다
         imageOprion = {offset: new daum.maps.Point(19, 58)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
         var normalImage = new daum.maps.MarkerImage(imageSrc, imageSize, imageOprion);

         var clickImageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', // 마커이미지의 주소입니다
         clickImageSize = new daum.maps.Size(64, 69), // 마커이미지의 크기입니다
         clickImageOprion = {offset: new daum.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
         var clickImage = new daum.maps.MarkerImage(clickImageSrc, clickImageSize, clickImageOprion);

         var markers = $(data.positions).map(function(i, position) {
         var marker = new daum.maps.Marker({
         position : new daum.maps.LatLng(position.lat, position.lng),
         image:normalImage
         });

         daum.maps.event.addListener(marker, 'click', function() {

         //                alert('GG : ' + position.lat);
         alert('KK : ' + selectedMarker);
         // 클릭된 마커가 없고, click 마커가 클릭된 마커가 아니면
         // 마커의 이미지를 클릭 이미지로 변경합니다
         if (!selectedMarker || selectedMarker !== marker) {

         // 클릭된 마커 객체가 null이 아니면
         // 클릭된 마커의 이미지를 기본 이미지로 변경하고
         !!selectedMarker && selectedMarker.setImage(normalImage);

         // 현재 클릭된 마커의 이미지는 클릭 이미지로 변경합니다
         marker.setImage(clickImage);
         }

         // 클릭된 마커를 현재 클릭된 마커 객체로 설정합니다
         selectedMarker = marker;
         });

         return marker;
         });

         // 클러스터러에 마커들을 추가합니다
         clusterer.addMarkers(markers);
         });*/
    }

    //Shop List
    function shopList(currentLat, currentLon) {
        var dataString = {'current_lat': currentLat, 'current_lon': currentLon};
        $.ajax({
            url: $("#url").val() + '/shopList',
            type: 'GET',
            dataType: 'json',
            data: dataString,
            success: function(data) {
                var shopData = data.shopData;
                $("#shop_length").val(shopData.length);
                $("#current_addr").val(data.address);
                var shopDataList = document.getElementById('map_list_wrap');
                var shopAddrList = document.getElementById('shop_addr_list');
                shopDataList.innerHTML = '';
                shopAddrList.innerHTML = '';

                for(var i=0; i<shopData.length; i++){
                    shopDataList.innerHTML += '<div class="address-row">' +
                        '<div class="col-xs-2 address-left">' +
                        '<a href="shop/shopInfo?shop_id='+ shopData[i].SHOP_ID +'"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></a>' +
                        '</div>' +
                        '<div class="col-xs-10 address-right">' +
                        '<a href="javascript:"><span class="icon" style="width:55px;height:55px;" onclick="guideLoad('+ i +')"><img src="/images/map_load_pin.png" style="width:50px;"></span></a>' +
                        '<h5 id="select_shop_name>'+ shopData[i].SHOP_NAME +'</h5>' +
                        '<span class="phone">TEL : '+ shopData[i].SHOP_PHONE +'</span>' +
                        '<p>'+ shopData[i].SHOP_ADDR +'</p>' +
                        '</div>' +
                        '<div class="clearfix"> </div>' +
                        '</div>';
                    shopAddrList.innerHTML += '<input type="hidden" name="shop_lat_'+ i +'" id="shop_lat_'+ i +'" value="'+ shopData[i].SHOP_LAT +'"/>'+
                        '<input type="hidden" name="shop_lon_'+ i +'" id="shop_lon_'+ i +'" value="'+ shopData[i].SHOP_LON +'"/>'+
                        '<input type="hidden" name="shop_addr_'+ i +'" id="shop_addr_'+ i +'" value="'+ shopData[i].SHOP_ADDR +'"/>'+
                        '<input type="hidden" name="shop_name_'+ i +'" id="shop_name_'+ i +'" value="'+ shopData[i].SHOP_NAME +'"/>';
                }
            },
            error: function(request, status, error) {
                console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                console.log('Error occured');
            }
        });
    }

    // 지도 확대, 축소 컨트롤에서 확대 버튼을 누르면 호출되어 지도를 확대하는 함수입니다
    function zoomIn() {
        map.setLevel(map.getLevel() - 1);
    }

    // 지도 확대, 축소 컨트롤에서 축소 버튼을 누르면 호출되어 지도를 확대하는 함수입니다
    function zoomOut() {
        map.setLevel(map.getLevel() + 1);
    }

    function guideLoad(index) {
        var currentAddr = $("#current_addr").val();
        var shopAddr = $("#shop_addr_"+index).val();
        var shopName = $("#shop_name_"+index).val();
        var shopLat = $("#shop_lat_"+index).val();
        var shopLon = $("#shop_lon_"+index).val();

        if(document.documentElement.clientWidth >= 736) {
            location.href="https://map.daum.net/?map_type=TYPE_SKYVIEW&map_hybrid=true&target=car&sName="+ currentAddr +"&eName="+ shopAddr +"";
        }else {
            // 지도를 재설정할 범위정보를 가지고 있을 LatLngBounds 객체를 생성합니다
            var bounds = new daum.maps.LatLngBounds();
            var imageSrc = "/images/my_point1.png";
            var imageSize = new daum.maps.Size(44, 51);
            var markerImage = new daum.maps.MarkerImage(imageSrc, imageSize);

            var moveMarker = new daum.maps.Marker({
                position : new daum.maps.LatLng(shopLat, shopLon),
                image : markerImage, // 마커 이미지
                clickable: true
            });
            moveMarker.setMap(map);

            var mouseEvent = {
                latLng: new daum.maps.LatLng(shopLat, shopLon)
            };

            daum.maps.event.trigger(map, 'click', mouseEvent);

            // LatLngBounds 객체에 좌표를 추가합니다
            bounds.extend(new daum.maps.LatLng(shopLat, shopLon));

            // LatLngBounds 객체에 추가된 좌표들을 기준으로 지도의 범위를 재설정합니다
            // 이때 지도의 중심좌표와 레벨이 변경될 수 있습니다
            map.setBounds(bounds);
        }
    }


</script>
<!-- //cart-js -->
<!-- start-smooth-scrolling -->
<script src="js/SmoothScroll.min.js"></script>
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function($) {
        /*$("#select_shop").click(function() {
            var dataString = {'shop_id': 'SB-SHOP-00001'};
            var headers = {};
            headers["user_id"] = '01000000000';

            $.ajax({
                url: $("#url").val() + '/shop/shopInfo',
                type: 'GET',
                headers : headers,
                dataType: 'json',
                data : dataString,
                success: function(data) {
                    console.log("select shop success : " + data.resultData);
                },
                error: function(request, status, error) {
                    console.error("select shop : code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }
            });
        });*/

        $(".scroll").click(function(event){
            event.preventDefault();

            $('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
        });

        $(".show-hide").click(function(){
            $(".show-hide-dropdown").toggle();
        });
    });
</script>
<!-- //end-smooth-scrolling -->
<!-- smooth-scrolling-of-move-up -->
<script type="text/javascript">
    $(document).ready(function() {
        /*
         var defaults = {
         containerID: 'toTop', // fading element id
         containerHoverID: 'toTopHover', // fading element hover id
         scrollSpeed: 1200,
         easingType: 'linear'
         };
         */

        $().UItoTop({ easingType: 'easeOutQuart' });
    });
</script>
<!-- //smooth-scrolling-of-move-up -->
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/bootstrap.js"></script>
</body>
</html>